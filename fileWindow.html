<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>File Viewer</title>
    <style>
      body {
        margin: 0;
        overflow: hidden;
        cursor: move;
      }
      #close-button {
        position: absolute;
        top: 10px;
        right: 10px;
        background-color: red;
        color: white;
        border: none;
        padding: 10px;
        cursor: pointer;
      }
      #transparency-slider {
        position: absolute;
        bottom: 10px;
        left: 10px;
        width: 200px;
      }
    </style>
  </head>
  <body>
    <button id="close-button">Close</button>
    <input
      type="range"
      id="transparency-slider"
      min="0"
      max="1"
      step="0.1"
      value="1"
    />
    <script nonce="ABC123">
      const { ipcRenderer } = require("electron");

      document.getElementById("close-button").addEventListener("click", () => {
        ipcRenderer.send("close-file-window");
      });

      const slider = document.getElementById("transparency-slider");
      slider.addEventListener("input", (event) => {
        const value = event.target.value;
        ipcRenderer.send("adjust-transparency", value);
      });

      let isDragging = false;
      let offset = { x: 0, y: 0 };

      window.addEventListener("mousedown", (event) => {
        isDragging = true;
        offset.x = event.clientX;
        offset.y = event.clientY;
      });

      window.addEventListener("mouseup", () => {
        isDragging = false;
      });

      window.addEventListener("mousemove", (event) => {
        if (isDragging) {
          const x = event.screenX - offset.x;
          const y = event.screenY - offset.y;
          ipcRenderer.send("move-window", { x, y });
        }
      });

      ipcRenderer.on("render-file", (event, filePath) => {
        const fileExtension = filePath.split(".").pop().toLowerCase();
        if (fileExtension === "pdf") {
          document.body.innerHTML = `<iframe src="file://${filePath}" style="width:100%; height:100%; border:none;"></iframe>`;
        } else if (["jpg", "png", "gif"].includes(fileExtension)) {
          document.body.innerHTML = `<img src="file://${filePath}" style="width:100%; height:100%;" />`;
        } else if (["txt", "docx"].includes(fileExtension)) {
          fetch(`file://${filePath}`)
            .then((response) => response.text())
            .then((text) => {
              document.body.innerHTML = `<pre>${text}</pre>`;
            });
        } else {
          document.body.innerHTML = "<h1>Unsupported file type</h1>";
        }
      });
    </script>
  </body>
</html>
